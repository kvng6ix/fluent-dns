<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🎨 Fluent DNS - Enhanced Premium Domain Service</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-purple: #8b5cf6;
            --dark-purple: #6d28d9;
            --light-purple: #a78bfa;
            --accent-purple: #c084fc;
            --black: #0f0f0f;
            --dark-gray: #1a1a1a;
            --medium-gray: #2d2d2d;
            --light-gray: #404040;
            --text-white: #ffffff;
            --text-gray: #a1a1aa;
            --success: #10b981;
            --error: #ef4444;
            --warning: #f59e0b;
            --blue: #3b82f6;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Inter', sans-serif;
            background: linear-gradient(135deg, var(--black) 0%, var(--dark-gray) 50%, var(--dark-purple) 100%);
            min-height: 100vh;
            color: var(--text-white);
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header Styles */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            background: rgba(139, 92, 246, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px 30px;
            border: 1px solid rgba(139, 92, 246, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .logo {
            font-size: 2.5em;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary-purple), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 30px rgba(139, 92, 246, 0.5);
        }

        .header-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .connect-btn {
            background: linear-gradient(135deg, var(--primary-purple), var(--dark-purple));
            color: var(--text-white);
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(139, 92, 246, 0.3);
        }

        .connect-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(139, 92, 246, 0.4);
        }

        .connect-btn:disabled {
            background: var(--medium-gray);
            cursor: not-allowed;
            transform: none;
        }

        /* Quick Search Bar */
        .quick-search {
            background: rgba(26, 26, 26, 0.8);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 40px;
            border: 1px solid rgba(139, 92, 246, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .search-container {
            position: relative;
            max-width: 600px;
            margin: 0 auto;
        }

        .search-input {
            width: 100%;
            padding: 20px 60px 20px 24px;
            background: var(--medium-gray);
            border: 2px solid rgba(139, 92, 246, 0.3);
            border-radius: 16px;
            color: var(--text-white);
            font-size: 18px;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary-purple);
            background: rgba(139, 92, 246, 0.1);
            box-shadow: 0 0 0 4px rgba(139, 92, 246, 0.1);
        }

        .search-btn {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            background: linear-gradient(135deg, var(--primary-purple), var(--dark-purple));
            border: none;
            padding: 12px 16px;
            border-radius: 12px;
            cursor: pointer;
            color: white;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .search-btn:hover:not(:disabled) {
            transform: translateY(-50%) scale(1.05);
        }

        .search-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--dark-gray);
            border: 1px solid rgba(139, 92, 246, 0.2);
            border-radius: 12px;
            margin-top: 8px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .suggestion-item {
            padding: 12px 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            border-bottom: 1px solid rgba(139, 92, 246, 0.1);
        }

        .suggestion-item:hover {
            background: rgba(139, 92, 246, 0.1);
        }

        .suggestion-item:last-child {
            border-bottom: none;
        }

        /* Stats Section */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: rgba(26, 26, 26, 0.8);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 30px;
            border: 1px solid rgba(139, 92, 246, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            border-color: var(--primary-purple);
            box-shadow: 0 12px 40px rgba(139, 92, 246, 0.2);
        }

        .stat-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
        }

        .stat-icon {
            font-size: 24px;
            opacity: 0.8;
        }

        .stat-title {
            font-size: 14px;
            color: var(--text-gray);
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-value {
            font-size: 2.8em;
            font-weight: 700;
            background: linear-gradient(135deg, var(--text-white), var(--light-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .stat-change {
            font-size: 12px;
            color: var(--success);
            font-weight: 500;
        }

        /* Recent Domains */
        .recent-domains {
            max-height: 300px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: var(--primary-purple) var(--dark-gray);
        }

        .recent-domains::-webkit-scrollbar {
            width: 6px;
        }

        .recent-domains::-webkit-scrollbar-track {
            background: var(--dark-gray);
            border-radius: 3px;
        }

        .recent-domains::-webkit-scrollbar-thumb {
            background: var(--primary-purple);
            border-radius: 3px;
        }

        .domain-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(139, 92, 246, 0.1);
            transition: all 0.2s ease;
        }

        .domain-item:hover {
            padding-left: 10px;
            background: rgba(139, 92, 246, 0.05);
            margin: 0 -10px;
            border-radius: 8px;
        }

        .domain-name {
            font-weight: 600;
            color: var(--accent-purple);
        }

        .domain-price {
            color: var(--success);
            font-size: 13px;
            font-weight: 500;
        }

        .domain-time {
            color: var(--text-gray);
            font-size: 11px;
        }

        /* Feature Boxes Grid */
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .feature-box {
            background: rgba(26, 26, 26, 0.8);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 35px;
            border: 1px solid rgba(139, 92, 246, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }

        .feature-box:hover {
            transform: translateY(-4px);
            border-color: var(--primary-purple);
            box-shadow: 0 12px 40px rgba(139, 92, 246, 0.2);
        }

        .section-title {
            font-size: 1.8em;
            font-weight: 700;
            margin-bottom: 25px;
            background: linear-gradient(135deg, var(--text-white), var(--light-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .section-icon {
            font-size: 1.2em;
            opacity: 0.8;
        }

        /* Wallet Info */
        .wallet-info {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(109, 40, 217, 0.1));
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 25px;
            border: 1px solid rgba(139, 92, 246, 0.3);
        }

        .wallet-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .wallet-label {
            color: var(--text-gray);
            font-size: 14px;
        }

        .wallet-value {
            color: var(--text-white);
            font-weight: 600;
        }

        /* Enhanced Pricing Section */
        .pricing-section {
            margin-bottom: 30px;
        }

        .pricing-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .tier {
            background: linear-gradient(135deg, var(--primary-purple), var(--dark-purple));
            color: var(--text-white);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
        }

        .tier::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .tier:hover::before {
            left: 100%;
        }

        .tier:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.4);
        }

        .tier-badge {
            background: rgba(255, 255, 255, 0.2);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 12px;
            display: inline-block;
        }

        .tier-price {
            font-size: 1.5em;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .tier-length {
            opacity: 0.9;
            font-size: 13px;
        }

        /* Bulk Registration */
        .bulk-registration {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(37, 99, 235, 0.1));
            border: 1px solid rgba(59, 130, 246, 0.2);
        }

        .bulk-input {
            width: 100%;
            min-height: 120px;
            padding: 16px 20px;
            background: var(--medium-gray);
            border: 2px solid rgba(59, 130, 246, 0.3);
            border-radius: 12px;
            color: var(--text-white);
            font-size: 14px;
            font-family: monospace;
            resize: vertical;
            transition: all 0.3s ease;
        }

        .bulk-input:focus {
            outline: none;
            border-color: var(--blue);
            background: rgba(59, 130, 246, 0.1);
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
        }

        .bulk-summary {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .summary-row:last-child {
            margin-bottom: 0;
            border-top: 1px solid rgba(59, 130, 246, 0.3);
            padding-top: 12px;
            margin-top: 12px;
            font-weight: 600;
        }

        /* Transaction History */
        .tx-history {
            max-height: 400px;
            overflow-y: auto;
        }

        .tx-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 0;
            border-bottom: 1px solid rgba(139, 92, 246, 0.1);
            transition: all 0.2s ease;
        }

        .tx-item:hover {
            padding-left: 10px;
            background: rgba(139, 92, 246, 0.05);
            margin: 0 -10px;
            border-radius: 8px;
        }

        .tx-info {
            flex: 1;
        }

        .tx-type {
            font-weight: 600;
            color: var(--accent-purple);
            margin-bottom: 4px;
        }

        .tx-details {
            font-size: 12px;
            color: var(--text-gray);
        }

        .tx-value {
            text-align: right;
        }

        .tx-amount {
            color: var(--success);
            font-weight: 600;
            margin-bottom: 4px;
        }

        .tx-time {
            font-size: 11px;
            color: var(--text-gray);
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 25px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-white);
            font-size: 14px;
        }

        .form-input {
            width: 100%;
            padding: 16px 20px;
            background: var(--medium-gray);
            border: 2px solid rgba(139, 92, 246, 0.3);
            border-radius: 12px;
            color: var(--text-white);
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-purple);
            background: rgba(139, 92, 246, 0.1);
            box-shadow: 0 0 0 4px rgba(139, 92, 246, 0.1);
        }

        .form-input::placeholder {
            color: var(--text-gray);
        }

        .form-input.invalid {
            border-color: var(--error);
            background: rgba(239, 68, 68, 0.1);
        }

        .form-input.valid {
            border-color: var(--success);
            background: rgba(16, 185, 129, 0.1);
        }

        .price-display {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(5, 150, 105, 0.1));
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            border-left: 4px solid var(--success);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .price-text {
            font-weight: 600;
            color: var(--text-white);
        }

        .price-value {
            font-size: 1.2em;
            font-weight: 700;
            color: var(--success);
        }

        /* Action Buttons */
        .button-group {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .btn {
            background: linear-gradient(135deg, var(--primary-purple), var(--dark-purple));
            color: var(--text-white);
            border: none;
            padding: 14px 24px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.2);
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.3);
        }

        .btn:disabled {
            background: var(--medium-gray);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-secondary {
            background: transparent;
            border: 2px solid var(--primary-purple);
        }

        .btn-secondary:hover:not(:disabled) {
            background: rgba(139, 92, 246, 0.1);
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning), #d97706);
        }

        .btn-warning:hover:not(:disabled) {
            box-shadow: 0 8px 25px rgba(245, 158, 11, 0.3);
        }

        .btn-blue {
            background: linear-gradient(135deg, var(--blue), #2563eb);
        }

        .btn-blue:hover:not(:disabled) {
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);
        }

        /* Status Messages */
        .status {
            margin: 20px 0;
            padding: 16px 20px;
            border-radius: 12px;
            font-weight: 500;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .status.success {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid var(--success);
            color: var(--success);
        }

        .status.error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid var(--error);
            color: var(--error);
        }

        .status.warning {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid var(--warning);
            color: var(--warning);
        }

        /* Result Display Boxes */
        .result-box {
            background: rgba(139, 92, 246, 0.05);
            border: 1px solid rgba(139, 92, 246, 0.2);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }

        .result-header {
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--accent-purple);
            font-size: 1.1em;
        }

        .result-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding: 8px 0;
            border-bottom: 1px solid rgba(139, 92, 246, 0.1);
        }

        .result-row:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .result-label {
            color: var(--text-gray);
            font-size: 14px;
        }

        .result-value {
            color: var(--text-white);
            font-weight: 600;
            font-family: monospace;
            font-size: 13px;
        }

        .copy-btn {
            background: rgba(139, 92, 246, 0.2);
            border: none;
            color: var(--accent-purple);
            padding: 4px 8px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 8px;
            transition: all 0.2s ease;
        }

        .copy-btn:hover {
            background: rgba(139, 92, 246, 0.4);
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(139, 92, 246, 0.3);
            border-top: 2px solid var(--primary-purple);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-large {
            width: 30px;
            height: 30px;
            border-width: 3px;
        }

        /* Footer */
        .footer {
            margin-top: auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 30px 0;
            border-top: 1px solid rgba(139, 92, 246, 0.2);
        }

        .footer a {
            color: var(--accent-purple);
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .footer a:hover {
            color: var(--text-white);
            text-shadow: 0 0 10px rgba(139, 92, 246, 0.5);
        }

        /* Tooltips */
        .tooltip {
            position: relative;
            cursor: help;
        }

        .tooltip::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--dark-gray);
            color: var(--text-white);
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s ease;
            border: 1px solid rgba(139, 92, 246, 0.3);
        }

        .tooltip:hover::after {
            opacity: 1;
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .features-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }

            .logo {
                font-size: 2em;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .pricing-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .features-grid {
                grid-template-columns: 1fr;
            }

            .feature-box {
                padding: 25px;
            }

            .button-group {
                flex-direction: column;
            }

            .footer {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
        }

        @media (max-width: 480px) {
            .pricing-grid {
                grid-template-columns: 1fr;
            }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        /* Enhanced animations */
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .scale-in {
            animation: scaleIn 0.3s ease-out;
        }

        @keyframes scaleIn {
            from { transform: scale(0.95); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">🎨 Fluent DNS</div>
            <div class="header-actions">
                <button id="networkStatus" class="btn btn-secondary" style="font-size: 12px;">Fluent Testnet</button>
                <button id="connectWallet" class="connect-btn">Connect Wallet</button>
            </div>
        </header>

        <!-- Quick Search -->
        <section class="quick-search fade-in">
            <div class="search-container">
                <input type="text" id="quickSearch" class="search-input" placeholder="🔍 Search domains, check availability, or lookup info..." autocomplete="off">
                <button id="quickSearchBtn" class="search-btn">Search</button>
                <div id="searchSuggestions" class="search-suggestions"></div>
            </div>
        </section>

        <!-- Statistics Grid -->
        <section class="stats-grid">
            <div class="stat-card scale-in">
                <div class="stat-header">
                    <span class="stat-icon">📈</span>
                    <div class="stat-title">Recent Activity</div>
                </div>
                <div class="recent-domains" id="recentDomains">
                    <div style="text-align: center; padding: 40px;">
                        <div class="loading loading-large"></div>
                        <div style="margin-top: 10px; color: var(--text-gray);">Loading live data...</div>
                    </div>
                </div>
            </div>

            <div class="stat-card scale-in">
                <div class="stat-header">
                    <span class="stat-icon">⏱️</span>
                    <div class="stat-title">Your Transaction History</div>
                </div>
                <div class="tx-history" id="txHistory">
                    <div style="text-align: center; padding: 40px; color: var(--text-gray);">
                        Connect wallet to view history
                    </div>
                </div>
            </div>
        </section>

        <!-- Wallet Connection Info -->
        <div id="walletInfo" class="wallet-info fade-in" style="display: none;">
            <div class="wallet-row">
                <span class="wallet-label">Connected Wallet:</span>
                <span class="wallet-value" id="walletAddress"></span>
            </div>
            <div class="wallet-row">
                <span class="wallet-label">Balance:</span>
                <span class="wallet-value" id="walletBalance">0.0000 ETH</span>
            </div>
            <div class="wallet-row">
                <span class="wallet-label">Your Domains:</span>
                <span class="wallet-value" id="userDomainCount">0</span>
            </div>
        </div>

        <!-- Enhanced Pricing Display -->
        <div class="pricing-section fade-in">
            <h3 style="margin-bottom: 15px; color: var(--text-white); text-align: center;">💎 Dynamic Pricing</h3>
            <div class="pricing-grid">
                <div class="tier">
                    <div class="tier-badge">Premium</div>
                    <div class="tier-price">0.01 ETH</div>
                    <div class="tier-length">1-5 characters</div>
                </div>
                <div class="tier">
                    <div class="tier-badge">Standard</div>
                    <div class="tier-price">0.005 ETH</div>
                    <div class="tier-length">6-10 characters</div>
                </div>
                <div class="tier">
                    <div class="tier-badge">Economy</div>
                    <div class="tier-price">0.001 ETH</div>
                    <div class="tier-length">11+ characters</div>
                </div>
            </div>
        </div>

        <!-- Feature Boxes Grid -->
        <div class="features-grid">
            <!-- Register Domain Box -->
            <div class="feature-box fade-in">
                <h2 class="section-title">
                    <span class="section-icon">🚀</span>
                    Register Domain
                </h2>

                <div class="form-group">
                    <label for="domainName" class="form-label">
                        Domain Name 
                        <span class="tooltip" data-tooltip="3-50 characters: lowercase a-z, numbers 0-9, and hyphens only">ℹ️</span>
                    </label>
                    <input type="text" id="domainName" class="form-input" placeholder="Enter your desired domain name">
                    <div id="domainValidation" style="margin-top: 8px; font-size: 12px;"></div>
                </div>

                <div class="form-group">
                    <label for="targetAddress" class="form-label">
                        Target Address 
                        <span class="tooltip" data-tooltip="The address this domain will point to. Defaults to your wallet address if empty">ℹ️</span>
                    </label>
                    <input type="text" id="targetAddress" class="form-input" placeholder="0x... (leave empty to use your address)">
                </div>

                <div class="price-display" id="priceDisplayContainer" style="display: none;">
                    <div class="price-text">Registration Price:</div>
                    <div class="price-value" id="priceDisplay"></div>
                </div>

                <div id="registerStatus"></div>

                <div class="button-group">
                    <button id="checkAvailabilityBtn" class="btn btn-secondary">🔍 Check Availability</button>
                    <button id="registerBtn" class="btn" disabled>🚀 Register Domain</button>
                </div>
            </div>

            <!-- Bulk Registration Box -->
            <div class="feature-box bulk-registration fade-in">
                <h2 class="section-title">
                    <span class="section-icon">📦</span>
                    Bulk Registration
                </h2>

                <div class="form-group">
                    <label for="bulkDomains" class="form-label">
                        Domain Names (one per line)
                        <span class="tooltip" data-tooltip="Enter multiple domain names, one per line. All will use your wallet address as target">ℹ️</span>
                    </label>
                    <textarea id="bulkDomains" class="bulk-input" placeholder="domain1&#10;domain2&#10;domain3&#10;..."></textarea>
                </div>

                <div id="bulkSummary" class="bulk-summary" style="display: none;">
                    <div class="summary-row">
                        <span>Valid Domains:</span>
                        <span id="validCount">0</span>
                    </div>
                    <div class="summary-row">
                        <span>Invalid Domains:</span>
                        <span id="invalidCount">0</span>
                    </div>
                    <div class="summary-row">
                        <span>Total Cost:</span>
                        <span id="totalCost">0 ETH</span>
                    </div>
                </div>

                <div id="bulkStatus"></div>

                <div class="button-group">
                    <button id="analyzeBulkBtn" class="btn btn-secondary">🔍 Analyze Domains</button>
                    <button id="bulkRegisterBtn" class="btn btn-blue" disabled>📦 Register All</button>
                </div>
            </div>

            <!-- Domain Ownership Checker -->
            <div class="feature-box fade-in">
                <h2 class="section-title">
                    <span class="section-icon">👤</span>
                    Domain Ownership Checker
                </h2>

                <div class="form-group">
                    <label for="ownershipDomain" class="form-label">
                        Enter Domain to Check Ownership
                    </label>
                    <input type="text" id="ownershipDomain" class="form-input" placeholder="Enter domain name">
                </div>

                <div id="ownershipStatus"></div>

                <div class="button-group">
                    <button id="checkOwnershipBtn" class="btn btn-secondary">🔍 Check Owner</button>
                </div>

                <div id="ownershipResults"></div>
            </div>

            <!-- Transfer Domain Box -->
            <div class="feature-box fade-in">
                <h2 class="section-title">
                    <span class="section-icon">↗️</span>
                    Transfer Domain
                </h2>

                <div class="form-group">
                    <label for="transferDomain" class="form-label">
                        Domain Name to Transfer
                    </label>
                    <input type="text" id="transferDomain" class="form-input" placeholder="Enter domain you own">
                </div>

                <div class="form-group">
                    <label for="newOwnerAddress" class="form-label">
                        New Owner Address
                    </label>
                    <input type="text" id="newOwnerAddress" class="form-input" placeholder="0x... (recipient address)">
                </div>

                <div id="transferStatus"></div>

                <div class="button-group">
                    <button id="verifyTransferBtn" class="btn btn-secondary">🔍 Verify Ownership</button>
                    <button id="transferBtn" class="btn btn-warning" disabled>↗️ Transfer Domain</button>
                </div>

                <div id="transferResults"></div>
            </div>

            <!-- Enhanced Domain Lookup Box -->
            <div class="feature-box fade-in">
                <h2 class="section-title">
                    <span class="section-icon">🔍</span>
                    Advanced Domain Lookup
                </h2>

                <div class="form-group">
                    <label for="lookupDomain" class="form-label">
                        Domain to Lookup
                    </label>
                    <input type="text" id="lookupDomain" class="form-input" placeholder="Enter domain to get full info">
                </div>

                <div id="lookupStatus"></div>

                <div class="button-group">
                    <button id="lookupBtn" class="btn btn-secondary">🔍 Get Domain Info</button>
                    <button id="exportBtn" class="btn btn-secondary" style="display: none;">📄 Export Data</button>
                </div>

                <div id="lookupResults"></div>
            </div>

            <!-- My Domains Box -->
            <div class="feature-box fade-in">
                <h2 class="section-title">
                    <span class="section-icon">🏠</span>
                    My Domains
                </h2>

                <div style="margin-bottom: 20px;">
                    <p style="color: var(--text-gray); font-size: 14px;">
                        View and manage all domains you own
                    </p>
                </div>

                <div id="myDomainsStatus"></div>

                <div class="button-group">
                    <button id="loadMyDomainsBtn" class="btn btn-secondary" disabled>🔍 Load My Domains</button>
                    <button id="refreshDomainsBtn" class="btn btn-secondary" style="display: none;">🔄 Refresh</button>
                </div>

                <div id="myDomainsResults"></div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <div>
                <a href="https://x.com/fluentxyz" target="_blank">Fluent X</a>
                <span style="margin: 0 10px;">•</span>
                <a href="https://testnet.fluentscan.xyz/" target="_blank">Block Explorer</a>
                <span style="margin: 0 10px;">•</span>
                <a href="#" onclick="showStats()">Live Stats</a>
            </div>
            <div>
                Enhanced by <a href="https://x.com/kvng6ixx" target="_blank">0xbito</a>
                <span style="margin: 0 10px;">•</span>
                <span style="font-size: 12px; color: var(--text-gray);">v2.0</span>
            </div>
        </footer>
    </div>

    <!-- Ethers.js Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.1/ethers.umd.min.js"></script>
    <script>
// Contract Configuration
const CONTRACT_ADDRESS = "0xF273cd4154D56d50FF32b09A224Cdc2F269b3acA";
const DEPLOYMENT_BLOCK = 3994017;

// Enhanced ABI from your smart contract
const CONTRACT_ABI = [
    "function register(string calldata name, address target) external payable",
    "function available(string calldata name) external view returns (bool)",
    "function getPrice(string calldata name) external view returns (uint256)",
    "function ownerOf(string calldata name) external view returns (address)",
    "function resolve(string calldata name) external view returns (address)",
    "function transferName(string calldata name, address newOwner) external",
    "function setAddress(string calldata name, address target) external",
    "function premiumPrice() external view returns (uint256)",
    "function standardPrice() external view returns (uint256)",
    "function economyPrice() external view returns (uint256)",
    "function batchRegister(string[] calldata names, address[] calldata targets) external payable",
    "event Registered(string name, address indexed owner, address target, uint256 price)",
    "event AddressSet(string name, address indexed target)",
    "event OwnershipTransferred(string name, address indexed oldOwner, address indexed newOwner)"
];

// Fluent Testnet Configuration
const FLUENT_TESTNET = {
    chainId: '0x5202', // 20994 in hex
    chainName: 'Fluent Testnet',
    nativeCurrency: { name: 'ETH', symbol: 'ETH', decimals: 18 },
    rpcUrls: ['https://rpc.testnet.fluent.xyz/'],
    blockExplorerUrls: ['https://testnet.fluentscan.xyz/']
};

// Global State
let provider = null;
let signer = null;
let contract = null;
let userAddress = null;
let allEvents = [];
let userDomains = [];

// Cache for better performance
const cache = {
    domainInfo: new Map(),
    availability: new Map(),
    prices: new Map()
};

// DOM Elements
const elements = {
    // Wallet & Network
    connectWallet: document.getElementById('connectWallet'),
    walletInfo: document.getElementById('walletInfo'),
    walletAddress: document.getElementById('walletAddress'),
    walletBalance: document.getElementById('walletBalance'),
    userDomainCount: document.getElementById('userDomainCount'),
    
    // Quick Search
    quickSearch: document.getElementById('quickSearch'),
    quickSearchBtn: document.getElementById('quickSearchBtn'),
    searchSuggestions: document.getElementById('searchSuggestions'),
    
    // Stats
    totalDomains: document.getElementById('totalDomains'),
    totalEthLocked: document.getElementById('totalEthLocked'),
    recentDomains: document.getElementById('recentDomains'),
    domainsChange: document.getElementById('domainsChange'),
    txHistory: document.getElementById('txHistory'),
    
    // Register Domain
    domainName: document.getElementById('domainName'),
    domainValidation: document.getElementById('domainValidation'),
    targetAddress: document.getElementById('targetAddress'),
    priceDisplay: document.getElementById('priceDisplay'),
    priceDisplayContainer: document.getElementById('priceDisplayContainer'),
    registerBtn: document.getElementById('registerBtn'),
    checkAvailabilityBtn: document.getElementById('checkAvailabilityBtn'),
    registerStatus: document.getElementById('registerStatus'),
    
    // Bulk Registration
    bulkDomains: document.getElementById('bulkDomains'),
    bulkSummary: document.getElementById('bulkSummary'),
    validCount: document.getElementById('validCount'),
    invalidCount: document.getElementById('invalidCount'),
    totalCost: document.getElementById('totalCost'),
    analyzeBulkBtn: document.getElementById('analyzeBulkBtn'),
    bulkRegisterBtn: document.getElementById('bulkRegisterBtn'),
    bulkStatus: document.getElementById('bulkStatus'),
    
    // Ownership Checker
    ownershipDomain: document.getElementById('ownershipDomain'),
    checkOwnershipBtn: document.getElementById('checkOwnershipBtn'),
    ownershipStatus: document.getElementById('ownershipStatus'),
    ownershipResults: document.getElementById('ownershipResults'),
    
    // Transfer Domain
    transferDomain: document.getElementById('transferDomain'),
    newOwnerAddress: document.getElementById('newOwnerAddress'),
    verifyTransferBtn: document.getElementById('verifyTransferBtn'),
    transferBtn: document.getElementById('transferBtn'),
    transferStatus: document.getElementById('transferStatus'),
    transferResults: document.getElementById('transferResults'),
    
    // Domain Lookup
    lookupDomain: document.getElementById('lookupDomain'),
    lookupBtn: document.getElementById('lookupBtn'),
    exportBtn: document.getElementById('exportBtn'),
    lookupStatus: document.getElementById('lookupStatus'),
    lookupResults: document.getElementById('lookupResults'),
    
    // My Domains
    loadMyDomainsBtn: document.getElementById('loadMyDomainsBtn'),
    refreshDomainsBtn: document.getElementById('refreshDomainsBtn'),
    myDomainsStatus: document.getElementById('myDomainsStatus'),
    myDomainsResults: document.getElementById('myDomainsResults')
};

// Utility Functions
function showStatus(elementId, message, type = 'success', duration = 5000) {
    const element = document.getElementById(elementId);
    element.innerHTML = `<div class="status ${type}">${message}</div>`;
    if (duration > 0) {
        setTimeout(() => element.innerHTML = '', duration);
    }
}

function formatAddress(address) {
    if (!address || address === ethers.ZeroAddress) return 'Not set';
    return `${address.slice(0, 6)}...${address.slice(-4)}`;
}

function calculatePrice(domainName) {
    if (!domainName) return null;
    const length = domainName.length;
    if (length <= 5) return '0.01';
    if (length <= 10) return '0.005';
    return '0.001';
}

function isValidDomainName(name) {
    if (!name || name.length < 3 || name.length > 50) return false;
    return /^[a-z0-9-]+$/.test(name);
}

function createCopyButton(text) {
    return `<button class="copy-btn" onclick="copyToClipboard('${text}')">📋</button>`;
}

function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(() => {
        showStatus('lookupStatus', '📋 Address copied to clipboard!', 'success', 2000);
    });
}

function formatTimeAgo(timestamp) {
    const now = Date.now();
    const diff = now - timestamp;
    const minutes = Math.floor(diff / 60000);
    const hours = Math.floor(diff / 3600000);
    const days = Math.floor(diff / 86400000);
    
    if (days > 0) return `${days}d ago`;
    if (hours > 0) return `${hours}h ago`;
    if (minutes > 0) return `${minutes}m ago`;
    return 'Just now';
}

function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}

// Enhanced Domain Validation
function validateDomain(domainName, showFeedback = true) {
    const validation = elements.domainValidation;
    if (!showFeedback) return isValidDomainName(domainName);
    
    if (!domainName) {
        validation.innerHTML = '';
        elements.domainName.classList.remove('valid', 'invalid');
        return false;
    }
    
    if (domainName.length < 3) {
        validation.innerHTML = '<span style="color: var(--error);">❌ Too short (minimum 3 characters)</span>';
        elements.domainName.classList.add('invalid');
        elements.domainName.classList.remove('valid');
        return false;
    }
    
    if (domainName.length > 50) {
        validation.innerHTML = '<span style="color: var(--error);">❌ Too long (maximum 50 characters)</span>';
        elements.domainName.classList.add('invalid');
        elements.domainName.classList.remove('valid');
        return false;
    }
    
    if (!/^[a-z0-9-]+$/.test(domainName)) {
        validation.innerHTML = '<span style="color: var(--error);">❌ Invalid characters (use only a-z, 0-9, and -)</span>';
        elements.domainName.classList.add('invalid');
        elements.domainName.classList.remove('valid');
        return false;
    }
    
    if (domainName.startsWith('-') || domainName.endsWith('-')) {
        validation.innerHTML = '<span style="color: var(--error);">❌ Cannot start or end with hyphen</span>';
        elements.domainName.classList.add('invalid');
        elements.domainName.classList.remove('valid');
        return false;
    }
    
    validation.innerHTML = '<span style="color: var(--success);">✅ Valid domain name</span>';
    elements.domainName.classList.add('valid');
    elements.domainName.classList.remove('invalid');
    return true;
}

// Quick Search Functionality
const debouncedSearch = debounce(handleQuickSearch, 300);

function handleQuickSearch() {
    const query = elements.quickSearch.value.toLowerCase().trim();
    if (!query) {
        elements.searchSuggestions.style.display = 'none';
        return;
    }
    
    // Generate suggestions
    const suggestions = [];
    
    if (isValidDomainName(query)) {
        suggestions.push(`🔍 Check "${query}" availability`);
        suggestions.push(`📊 Lookup "${query}" info`);
        suggestions.push(`💰 Price for "${query}": ${calculatePrice(query)} ETH`);
    }
    
    // Add recent domains suggestions
    if (allEvents.length > 0) {
        const recentSuggestions = allEvents
            .filter(event => event.args.name.toLowerCase().includes(query))
            .slice(0, 3)
            .map(event => `📈 Recent: ${event.args.name}`);
        suggestions.push(...recentSuggestions);
    }
    
    if (suggestions.length === 0) {
        elements.searchSuggestions.style.display = 'none';
        return;
    }
    
    elements.searchSuggestions.innerHTML = suggestions
        .slice(0, 5)
        .map(suggestion => `<div class="suggestion-item" onclick="selectSuggestion('${suggestion}')">${suggestion}</div>`)
        .join('');
    elements.searchSuggestions.style.display = 'block';
}

function selectSuggestion(suggestion) {
    elements.searchSuggestions.style.display = 'none';
    
    if (suggestion.includes('Check') && suggestion.includes('availability')) {
        const domain = suggestion.match(/"([^"]+)"/)[1];
        elements.domainName.value = domain;
        elements.checkAvailabilityBtn.click();
        document.querySelector('[href="#register"]')?.click();
    } else if (suggestion.includes('Lookup')) {
        const domain = suggestion.match(/"([^"]+)"/)[1];
        elements.lookupDomain.value = domain;
        elements.lookupBtn.click();
    } else if (suggestion.includes('Recent:')) {
        const domain = suggestion.split('Recent: ')[1];
        elements.lookupDomain.value = domain;
        elements.lookupBtn.click();
    }
}

// Wallet Connection
async function connectWallet() {
    try {
        if (typeof window.ethereum === 'undefined') {
            showStatus('registerStatus', 'Please install MetaMask or another Web3 wallet', 'error');
            return;
        }

        elements.connectWallet.innerHTML = '<span class="loading"></span> Connecting...';
        elements.connectWallet.disabled = true;

        await window.ethereum.request({ method: 'eth_requestAccounts' });
        provider = new ethers.BrowserProvider(window.ethereum);

        const network = await provider.getNetwork();
        if (network.chainId !== 20994n) {
            await switchToFluentTestnet();
        }

        signer = await provider.getSigner();
        userAddress = await signer.getAddress();
        contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);

        // Update UI
        elements.connectWallet.textContent = 'Connected';
        elements.connectWallet.style.background = 'var(--success)';
        elements.registerBtn.disabled = false;
        elements.loadMyDomainsBtn.disabled = false;

        // Show wallet info
        elements.walletAddress.textContent = formatAddress(userAddress);
        const balance = await provider.getBalance(userAddress);
        elements.walletBalance.textContent = `${parseFloat(ethers.formatEther(balance)).toFixed(4)} ETH`;
        elements.walletInfo.style.display = 'block';

        showStatus('registerStatus', '✅ Wallet connected successfully!', 'success');
        
        // Load user-specific data
        await loadUserDomains();
        await loadUserTransactionHistory();
        
    } catch (error) {
        console.error('Error connecting wallet:', error);
        showStatus('registerStatus', '❌ Failed to connect wallet: ' + error.message, 'error');
        elements.connectWallet.innerHTML = 'Connect Wallet';
        elements.connectWallet.disabled = false;
    }
}

// Switch to Fluent Testnet
async function switchToFluentTestnet() {
    try {
        await window.ethereum.request({
            method: 'wallet_switchEthereumChain',
            params: [{ chainId: FLUENT_TESTNET.chainId }],
        });
    } catch (switchError) {
        if (switchError.code === 4902) {
            await window.ethereum.request({
                method: 'wallet_addEthereumChain',
                params: [FLUENT_TESTNET],
            });
        } else {
            throw switchError;
        }
    }
}

// Load User Domains
async function loadUserDomains() {
    if (!userAddress || !allEvents.length) return;
    
    userDomains = allEvents
        .filter(event => event.args.owner.toLowerCase() === userAddress.toLowerCase())
        .map(event => ({
            name: event.args.name,
            target: event.args.target,
            price: event.args.price,
            blockNumber: event.blockNumber,
            transactionHash: event.transactionHash
        }));
    
    elements.userDomainCount.textContent = userDomains.length;
}

// Load User Transaction History
async function loadUserTransactionHistory() {
    if (!userAddress || !allEvents.length) return;
    
    const userEvents = allEvents
        .filter(event => event.args.owner.toLowerCase() === userAddress.toLowerCase())
        .slice(-10)
        .reverse();
    
    if (userEvents.length === 0) {
        elements.txHistory.innerHTML = '<div style="text-align: center; color: var(--text-gray); padding: 20px;">No transactions found</div>';
        return;
    }
    
    elements.txHistory.innerHTML = userEvents.map(event => `
        <div class="tx-item">
            <div class="tx-info">
                <div class="tx-type">Domain Registration</div>
                <div class="tx-details">${event.args.name}</div>
            </div>
            <div class="tx-value">
                <div class="tx-amount">${ethers.formatEther(event.args.price)} ETH</div>
                <div class="tx-time">Block #${event.blockNumber}</div>
            </div>
        </div>
    `).join('');
}

// Enhanced Statistics Loading
async function loadStats() {
    try {
        const readProvider = new ethers.JsonRpcProvider('https://rpc.testnet.fluent.xyz/');
        const readContract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, readProvider);
        
        const currentBlock = await readProvider.getBlockNumber();
        
        // Search in chunks to avoid RPC limits
        const CHUNK_SIZE = 5000;
        allEvents = [];
        
        for (let fromBlock = DEPLOYMENT_BLOCK; fromBlock <= currentBlock; fromBlock += CHUNK_SIZE) {
            const toBlock = Math.min(fromBlock + CHUNK_SIZE - 1, currentBlock);
            
            try {
                const filter = readContract.filters.Registered();
                const chunkEvents = await readContract.queryFilter(filter, fromBlock, toBlock);
                allEvents = allEvents.concat(chunkEvents);
            } catch (chunkError) {
                console.warn(`Error fetching chunk ${fromBlock}-${toBlock}:`, chunkError);
            }
        }

        // Update total domains
        elements.totalDomains.textContent = allEvents.length.toString();
        elements.domainsChange.textContent = `Since deployment`;

        // Calculate total ETH locked
        let totalEthLocked = 0n;
        allEvents.forEach(event => {
            if (event.args && event.args.price) {
                totalEthLocked += event.args.price;
            }
        });
        elements.totalEthLocked.textContent = parseFloat(ethers.formatEther(totalEthLocked)).toFixed(4);

        // Show recent domains with enhanced info
        const recentEvents = allEvents.slice(-10).reverse();
        
        if (recentEvents.length === 0) {
            elements.recentDomains.innerHTML = '<div style="text-align: center; color: var(--text-gray); padding: 20px;">No domains registered yet</div>';
        } else {
            elements.recentDomains.innerHTML = recentEvents.map(event => `
                <div class="domain-item">
                    <div>
                        <div class="domain-name">${event.args.name}</div>
                        <div class="domain-time">Block #${event.blockNumber}</div>
                    </div>
                    <span class="domain-price">${ethers.formatEther(event.args.price)} ETH</span>
                </div>
            `).join('');
        }
        
        // Update user-specific data if connected
        if (userAddress) {
            await loadUserDomains();
            await loadUserTransactionHistory();
        }
        
    } catch (error) {
        console.error('Error loading stats:', error);
        elements.totalDomains.textContent = 'Error';
        elements.totalEthLocked.textContent = 'Error';
        elements.recentDomains.innerHTML = '<div style="text-align: center; color: var(--error);">Unable to load data</div>';
    }
}

// Domain Registration Functions
elements.domainName.addEventListener('input', (e) => {
    const domainName = e.target.value.toLowerCase();
    e.target.value = domainName;
    
    validateDomain(domainName);
    
    if (domainName && isValidDomainName(domainName)) {
        const price = calculatePrice(domainName);
        elements.priceDisplay.textContent = `${price} ETH`;
        elements.priceDisplayContainer.style.display = 'flex';
    } else if (domainName) {
        elements.priceDisplay.textContent = 'Invalid domain name';
        elements.priceDisplayContainer.style.display = 'flex';
    } else {
        elements.priceDisplayContainer.style.display = 'none';
    }
});

elements.checkAvailabilityBtn.addEventListener('click', async () => {
    const domainName = elements.domainName.value.toLowerCase().trim();
    
    if (!domainName) {
        showStatus('registerStatus', '⚠️ Please enter a domain name', 'warning');
        return;
    }
    
    if (!isValidDomainName(domainName)) {
        showStatus('registerStatus', '❌ Invalid domain name. Use only a-z, 0-9, and hyphens. Length: 3-50 characters.', 'error');
        return;
    }

    if (!contract) {
        showStatus('registerStatus', '⚠️ Please connect your wallet first', 'warning');
        return;
    }

    try {
        elements.checkAvailabilityBtn.innerHTML = '<span class="loading"></span> Checking...';
        elements.checkAvailabilityBtn.disabled = true;
        
        // Check cache first
        const cacheKey = `availability_${domainName}`;
        if (cache.availability.has(cacheKey)) {
            const available = cache.availability.get(cacheKey);
            if (available) {
                showStatus('registerStatus', `✅ "${domainName}" is available for registration!`, 'success');
            } else {
                showStatus('registerStatus', `❌ "${domainName}" is already taken`, 'error');
            }
        } else {
            const available = await contract.available(domainName);
            cache.availability.set(cacheKey, available);
            
            if (available) {
                showStatus('registerStatus', `✅ "${domainName}" is available for registration!`, 'success');
            } else {
                showStatus('registerStatus', `❌ "${domainName}" is already taken`, 'error');
            }
        }
    } catch (error) {
        console.error('Error checking availability:', error);
        showStatus('registerStatus', '❌ Error checking availability: ' + error.message, 'error');
    } finally {
        elements.checkAvailabilityBtn.innerHTML = '🔍 Check Availability';
        elements.checkAvailabilityBtn.disabled = false;
    }
});

elements.registerBtn.addEventListener('click', async () => {
    const domainName = elements.domainName.value.toLowerCase().trim();
    const targetAddress = elements.targetAddress.value.trim();
    
    if (!domainName) {
        showStatus('registerStatus', '⚠️ Please enter a domain name', 'warning');
        return;
    }
    
    if (!isValidDomainName(domainName)) {
        showStatus('registerStatus', '❌ Invalid domain name. Use only a-z, 0-9, and hyphens. Length: 3-50 characters.', 'error');
        return;
    }

    if (!contract) {
        showStatus('registerStatus', '⚠️ Please connect your wallet first', 'warning');
        return;
    }

    try {
        elements.registerBtn.innerHTML = '<span class="loading"></span> Registering...';
        elements.registerBtn.disabled = true;
        
        const available = await contract.available(domainName);
        if (!available) {
            showStatus('registerStatus', '❌ Domain is already taken', 'error');
            return;
        }

        const price = calculatePrice(domainName);
        const priceInWei = ethers.parseEther(price);
        
        const target = targetAddress && ethers.isAddress(targetAddress) 
            ? targetAddress 
            : ethers.ZeroAddress;

        showStatus('registerStatus', '📝 Please confirm the transaction in your wallet...', 'warning');

        const tx = await contract.register(domainName, target, {
            value: priceInWei
        });
        
        showStatus('registerStatus', '⏳ Transaction submitted. Waiting for confirmation...', 'warning');
        
        const receipt = await tx.wait();
        
        showStatus('registerStatus', `🎉 Successfully registered "${domainName}"! TX: ${receipt.hash.slice(0, 10)}...`, 'success');
        
        // Clear inputs and cache
        elements.domainName.value = '';
        elements.targetAddress.value = '';
        elements.priceDisplayContainer.style.display = 'none';
        elements.domainValidation.innerHTML = '';
        elements.domainName.classList.remove('valid', 'invalid');
        cache.availability.delete(`availability_${domainName}`);
        
        // Refresh wallet balance and stats
        const balance = await provider.getBalance(userAddress);
        elements.walletBalance.textContent = `${parseFloat(ethers.formatEther(balance)).toFixed(4)} ETH`;
        setTimeout(loadStats, 2000);
        
    } catch (error) {
        console.error('Error registering domain:', error);
        let errorMessage = '❌ Registration failed';
        if (error.message.includes('insufficient funds')) {
            errorMessage = '💸 Insufficient funds for registration';
        } else if (error.message.includes('user rejected')) {
            errorMessage = '🚫 Transaction cancelled by user';
        }
        showStatus('registerStatus', errorMessage, 'error');
    } finally {
        elements.registerBtn.innerHTML = '🚀 Register Domain';
        elements.registerBtn.disabled = false;
    }
});

// Bulk Registration Functions
elements.bulkDomains.addEventListener('input', analyzeBulkDomains);

function analyzeBulkDomains() {
    const domains = elements.bulkDomains.value
        .split('\n')
        .map(d => d.trim().toLowerCase())
        .filter(d => d.length > 0);
    
    if (domains.length === 0) {
        elements.bulkSummary.style.display = 'none';
        return;
    }
    
    const valid = domains.filter(isValidDomainName);
    const invalid = domains.filter(d => !isValidDomainName(d));
    
    let totalCost = 0;
    valid.forEach(domain => {
        totalCost += parseFloat(calculatePrice(domain));
    });
    
    elements.validCount.textContent = valid.length;
    elements.invalidCount.textContent = invalid.length;
    elements.totalCost.textContent = `${totalCost.toFixed(3)} ETH`;
    elements.bulkSummary.style.display = 'block';
    
    if (valid.length > 0 && invalid.length === 0) {
        elements.bulkRegisterBtn.disabled = !contract;
    } else {
        elements.bulkRegisterBtn.disabled = true;
    }
}

elements.analyzeBulkBtn.addEventListener('click', async () => {
    const domains = elements.bulkDomains.value
        .split('\n')
        .map(d => d.trim().toLowerCase())
        .filter(d => d.length > 0);
    
    if (domains.length === 0) {
        showStatus('bulkStatus', '⚠️ Please enter domain names', 'warning');
        return;
    }
    
    if (!contract) {
        showStatus('bulkStatus', '⚠️ Please connect your wallet first', 'warning');
        return;
    }
    
    try {
        elements.analyzeBulkBtn.innerHTML = '<span class="loading"></span> Analyzing...';
        elements.analyzeBulkBtn.disabled = true;
        
        const valid = domains.filter(isValidDomainName);
        const invalid = domains.filter(d => !isValidDomainName(d));
        
        if (invalid.length > 0) {
            showStatus('bulkStatus', `❌ ${invalid.length} invalid domain names found: ${invalid.slice(0, 3).join(', ')}${invalid.length > 3 ? '...' : ''}`, 'error');
            return;
        }
        
        // Check availability for all domains
        const availabilityPromises = valid.map(domain => 
            contract.available(domain).then(available => ({ domain, available }))
        );
        
        const results = await Promise.all(availabilityPromises);
        const available = results.filter(r => r.available);
        const taken = results.filter(r => !r.available);
        
        if (taken.length > 0) {
            showStatus('bulkStatus', `❌ ${taken.length} domains already taken: ${taken.slice(0, 3).map(r => r.domain).join(', ')}${taken.length > 3 ? '...' : ''}`, 'error');
        } else {
            showStatus('bulkStatus', `✅ All ${available.length} domains are available for registration!`, 'success');
            elements.bulkRegisterBtn.disabled = false;
        }
        
    } catch (error) {
        console.error('Error analyzing bulk domains:', error);
        showStatus('bulkStatus', '❌ Error analyzing domains: ' + error.message, 'error');
    } finally {
        elements.analyzeBulkBtn.innerHTML = '🔍 Analyze Domains';
        elements.analyzeBulkBtn.disabled = false;
    }
});

elements.bulkRegisterBtn.addEventListener('click', async () => {
    const domains = elements.bulkDomains.value
        .split('\n')
        .map(d => d.trim().toLowerCase())
        .filter(d => d.length > 0 && isValidDomainName(d));
    
    if (!contract) {
        showStatus('bulkStatus', '⚠️ Please connect your wallet first', 'warning');
        return;
    }
    
    try {
        elements.bulkRegisterBtn.innerHTML = '<span class="loading"></span> Registering...';
        elements.bulkRegisterBtn.disabled = true;
        
        let totalCost = 0;
        domains.forEach(domain => {
            totalCost += parseFloat(calculatePrice(domain));
        });
        
        const targets = domains.map(() => ethers.ZeroAddress);
        const totalCostWei = ethers.parseEther(totalCost.toString());
        
        showStatus('bulkStatus', '📝 Please confirm the bulk registration transaction in your wallet...', 'warning');
        
        const tx = await contract.batchRegister(domains, targets, {
            value: totalCostWei
        });
        
        showStatus('bulkStatus', `⏳ Bulk registration submitted. Registering ${domains.length} domains...`, 'warning');
        
        const receipt = await tx.wait();
        
        showStatus('bulkStatus', `🎉 Successfully registered ${domains.length} domains! TX: ${receipt.hash.slice(0, 10)}...`, 'success');
        
        // Clear inputs and refresh data
        elements.bulkDomains.value = '';
        elements.bulkSummary.style.display = 'none';
        const balance = await provider.getBalance(userAddress);
        elements.walletBalance.textContent = `${parseFloat(ethers.formatEther(balance)).toFixed(4)} ETH`;
        setTimeout(loadStats, 2000);
        
    } catch (error) {
        console.error('Error bulk registering domains:', error);
        let errorMessage = '❌ Bulk registration failed';
        if (error.message.includes('insufficient funds')) {
            errorMessage = '💸 Insufficient funds for bulk registration';
        } else if (error.message.includes('user rejected')) {
            errorMessage = '🚫 Transaction cancelled by user';
        }
        showStatus('bulkStatus', errorMessage, 'error');
    } finally {
        elements.bulkRegisterBtn.innerHTML = '📦 Register All';
        elements.bulkRegisterBtn.disabled = true;
    }
});

// Ownership Checker Functions
elements.checkOwnershipBtn.addEventListener('click', async () => {
    const domainName = elements.ownershipDomain.value.toLowerCase().trim();
    
    if (!domainName) {
        showStatus('ownershipStatus', '⚠️ Please enter a domain name to check', 'warning');
        return;
    }

    try {
        elements.checkOwnershipBtn.innerHTML = '<span class="loading"></span> Checking...';
        elements.checkOwnershipBtn.disabled = true;
        
        const readProvider = new ethers.JsonRpcProvider('https://rpc.testnet.fluent.xyz/');
        const readContract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, readProvider);
        
        const owner = await readContract.ownerOf(domainName);
        const target = await readContract.resolve(domainName);
        const available = await readContract.available(domainName);
        
        if (available || owner === ethers.ZeroAddress) {
            elements.ownershipResults.innerHTML = `
                <div class="result-box">
                    <div class="result-header">❌ Domain Not Registered</div>
                    <p style="color: var(--text-gray); margin-top: 10px;">
                        "${domainName}" is available for registration.
                    </p>
                </div>
            `;
        } else {
            elements.ownershipResults.innerHTML = `
                <div class="result-box">
                    <div class="result-header">✅ Domain Owner Information</div>
                    <div class="result-row">
                        <span class="result-label">Domain:</span>
                        <span class="result-value">${domainName}</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">Owner:</span>
                        <span class="result-value">${formatAddress(owner)}${createCopyButton(owner)}</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">Points To:</span>
                        <span class="result-value">${formatAddress(target)}${createCopyButton(target)}</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">Status:</span>
                        <span class="result-value" style="color: var(--success);">Registered</span>
                    </div>
                </div>
            `;
        }
        
        showStatus('ownershipStatus', '✅ Ownership check completed', 'success');
        
    } catch (error) {
        console.error('Error checking ownership:', error);
        showStatus('ownershipStatus', '❌ Error checking ownership: ' + error.message, 'error');
        elements.ownershipResults.innerHTML = '';
    } finally {
        elements.checkOwnershipBtn.innerHTML = '🔍 Check Owner';
        elements.checkOwnershipBtn.disabled = false;
    }
});

// Transfer Domain Functions
elements.verifyTransferBtn.addEventListener('click', async () => {
    const domainName = elements.transferDomain.value.toLowerCase().trim();
    
    if (!domainName) {
        showStatus('transferStatus', '⚠️ Please enter a domain name', 'warning');
        return;
    }

    if (!contract) {
        showStatus('transferStatus', '⚠️ Please connect your wallet first', 'warning');
        return;
    }

    try {
        elements.verifyTransferBtn.innerHTML = '<span class="loading"></span> Verifying...';
        elements.verifyTransferBtn.disabled = true;
        
        const owner = await contract.ownerOf(domainName);
        
        if (owner === ethers.ZeroAddress) {
            showStatus('transferStatus', '❌ Domain not registered', 'error');
            elements.transferResults.innerHTML = '';
            elements.transferBtn.disabled = true;
            return;
        }

        if (owner.toLowerCase() !== userAddress.toLowerCase()) {
            showStatus('transferStatus', '❌ You do not own this domain', 'error');
            elements.transferResults.innerHTML = `
                <div class="result-box">
                    <div class="result-header">❌ Transfer Not Allowed</div>
                    <div class="result-row">
                        <span class="result-label">Domain:</span>
                        <span class="result-value">${domainName}</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">Current Owner:</span>
                        <span class="result-value">${formatAddress(owner)}</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">Your Address:</span>
                        <span class="result-value">${formatAddress(userAddress)}</span>
                    </div>
                </div>
            `;
            elements.transferBtn.disabled = true;
            return;
        }

        // User owns the domain
        const target = await contract.resolve(domainName);
        elements.transferResults.innerHTML = `
            <div class="result-box">
                <div class="result-header">✅ Ready to Transfer</div>
                <div class="result-row">
                    <span class="result-label">Domain:</span>
                    <span class="result-value">${domainName}</span>
                </div>
                <div class="result-row">
                    <span class="result-label">Current Owner:</span>
                    <span class="result-value">${formatAddress(owner)} (You)</span>
                </div>
                <div class="result-row">
                    <span class="result-label">Points To:</span>
                    <span class="result-value">${formatAddress(target)}</span>
                </div>
            </div>
        `;
        
        elements.transferBtn.disabled = false;
        showStatus('transferStatus', '✅ You own this domain. Ready to transfer!', 'success');
        
    } catch (error) {
        console.error('Error verifying transfer:', error);
        showStatus('transferStatus', '❌ Error verifying ownership: ' + error.message, 'error');
        elements.transferBtn.disabled = true;
    } finally {
        elements.verifyTransferBtn.innerHTML = '🔍 Verify Ownership';
        elements.verifyTransferBtn.disabled = false;
    }
});

elements.transferBtn.addEventListener('click', async () => {
    const domainName = elements.transferDomain.value.toLowerCase().trim();
    const newOwnerAddress = elements.newOwnerAddress.value.trim();
    
    if (!newOwnerAddress) {
        showStatus('transferStatus', '⚠️ Please enter the new owner address', 'warning');
        return;
    }

    if (!ethers.isAddress(newOwnerAddress)) {
        showStatus('transferStatus', '❌ Invalid Ethereum address', 'error');
        return;
    }

    if (!contract) {
        showStatus('transferStatus', '⚠️ Please connect your wallet first', 'warning');
        return;
    }

    try {
        elements.transferBtn.innerHTML = '<span class="loading"></span> Transferring...';
        elements.transferBtn.disabled = true;
        
        showStatus('transferStatus', '📝 Please confirm the transfer in your wallet...', 'warning');

        const tx = await contract.transferName(domainName, newOwnerAddress);
        
        showStatus('transferStatus', '⏳ Transfer transaction submitted. Waiting for confirmation...', 'warning');
        
        const receipt = await tx.wait();
        
        showStatus('transferStatus', `🎉 Successfully transferred "${domainName}" to ${formatAddress(newOwnerAddress)}!`, 'success');
        
        // Update results
        elements.transferResults.innerHTML = `
            <div class="result-box">
                <div class="result-header">✅ Transfer Completed</div>
                <div class="result-row">
                    <span class="result-label">Domain:</span>
                    <span class="result-value">${domainName}</span>
                </div>
                <div class="result-row">
                    <span class="result-label">New Owner:</span>
                    <span class="result-value">${formatAddress(newOwnerAddress)}</span>
                </div>
                <div class="result-row">
                    <span class="result-label">Transaction:</span>
                    <span class="result-value">${receipt.hash.slice(0, 20)}...</span>
                </div>
            </div>
        `;
        
        // Clear inputs
        elements.transferDomain.value = '';
        elements.newOwnerAddress.value = '';
        
        // Refresh user data
        setTimeout(loadStats, 2000);
        
    } catch (error) {
        console.error('Error transferring domain:', error);
        let errorMessage = '❌ Transfer failed';
        if (error.message.includes('user rejected')) {
            errorMessage = '🚫 Transfer cancelled by user';
        } else if (error.message.includes('Not name owner')) {
            errorMessage = '❌ You are not the owner of this domain';
        }
        showStatus('transferStatus', errorMessage, 'error');
    } finally {
        elements.transferBtn.innerHTML = '↗️ Transfer Domain';
        elements.transferBtn.disabled = true;
    }
});

// Enhanced Domain Lookup Functions
elements.lookupBtn.addEventListener('click', async () => {
    const domainName = elements.lookupDomain.value.toLowerCase().trim();
    
    if (!domainName) {
        showStatus('lookupStatus', '⚠️ Please enter a domain name to lookup', 'warning');
        return;
    }

    try {
        elements.lookupBtn.innerHTML = '<span class="loading"></span> Looking up...';
        elements.lookupBtn.disabled = true;
        
        const readProvider = new ethers.JsonRpcProvider('https://rpc.testnet.fluent.xyz/');
        const readContract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, readProvider);
        
        const owner = await readContract.ownerOf(domainName);
        const target = await readContract.resolve(domainName);
        const available = await readContract.available(domainName);
        const price = await readContract.getPrice(domainName);
        
        // Get registration event if available
        let registrationInfo = '';
        const domainEvent = allEvents.find(event => event.args.name === domainName);
        if (domainEvent) {
            registrationInfo = `
                <div class="result-row">
                    <span class="result-label">Registered Block:</span>
                    <span class="result-value">#${domainEvent.blockNumber}</span>
                </div>
                <div class="result-row">
                    <span class="result-label">Registration TX:</span>
                    <span class="result-value">${domainEvent.transactionHash.slice(0, 20)}...${createCopyButton(domainEvent.transactionHash)}</span>
                </div>
            `;
        }
        
        if (available || owner === ethers.ZeroAddress) {
            elements.lookupResults.innerHTML = `
                <div class="result-box">
                    <div class="result-header">🟡 Domain Available</div>
                    <div class="result-row">
                        <span class="result-label">Domain:</span>
                        <span class="result-value">${domainName}</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">Status:</span>
                        <span class="result-value" style="color: var(--warning);">Available for registration</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">Registration Price:</span>
                        <span class="result-value" style="color: var(--success);">${ethers.formatEther(price)} ETH</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">Character Length:</span>
                        <span class="result-value">${domainName.length} chars</span>
                    </div>
                </div>
            `;
            elements.exportBtn.style.display = 'none';
        } else {
            elements.lookupResults.innerHTML = `
                <div class="result-box">
                    <div class="result-header">✅ Domain Information</div>
                    <div class="result-row">
                        <span class="result-label">Domain:</span>
                        <span class="result-value">${domainName}</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">Status:</span>
                        <span class="result-value" style="color: var(--success);">Registered</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">Owner:</span>
                        <span class="result-value">${formatAddress(owner)}${createCopyButton(owner)}</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">Target Address:</span>
                        <span class="result-value">${formatAddress(target)}${createCopyButton(target)}</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">Registration Price:</span>
                        <span class="result-value">${ethers.formatEther(price)} ETH</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">Character Length:</span>
                        <span class="result-value">${domainName.length} chars</span>
                    </div>
                    ${registrationInfo}
                </div>
            `;
            elements.exportBtn.style.display = 'inline-block';
            
            // Store data for export
            window.lastLookupData = {
                domain: domainName,
                owner,
                target,
                price: ethers.formatEther(price),
                length: domainName.length,
                registrationBlock: domainEvent?.blockNumber,
                registrationTx: domainEvent?.transactionHash
            };
        }
        
        showStatus('lookupStatus', '✅ Domain lookup completed', 'success');
        
    } catch (error) {
        console.error('Error looking up domain:', error);
        showStatus('lookupStatus', '❌ Error looking up domain: ' + error.message, 'error');
        elements.lookupResults.innerHTML = '';
        elements.exportBtn.style.display = 'none';
    } finally {
        elements.lookupBtn.innerHTML = '🔍 Get Domain Info';
        elements.lookupBtn.disabled = false;
    }
});

// Export function
elements.exportBtn.addEventListener('click', () => {
    if (!window.lastLookupData) return;
    
    const data = window.lastLookupData;
    const csvContent = `Domain,Owner,Target,Price (ETH),Length,Registration Block,Registration TX\n${data.domain},${data.owner},${data.target},${data.price},${data.length},${data.registrationBlock || 'N/A'},${data.registrationTx || 'N/A'}`;
    
    const blob = new Blob([csvContent], { type: 'text/csv' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `${data.domain}_domain_info.csv`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    window.URL.revokeObjectURL(url);
    
    showStatus('lookupStatus', '📄 Domain data exported successfully!', 'success', 2000);
});

// My Domains Functions
elements.loadMyDomainsBtn.addEventListener('click', loadMyDomainsDetailed);
elements.refreshDomainsBtn.addEventListener('click', loadMyDomainsDetailed);

async function loadMyDomainsDetailed() {
    if (!userAddress) {
        showStatus('myDomainsStatus', '⚠️ Please connect your wallet first', 'warning');
        return;
    }
    
    try {
        elements.loadMyDomainsBtn.innerHTML = '<span class="loading"></span> Loading...';
        elements.loadMyDomainsBtn.disabled = true;
        
        if (userDomains.length === 0) {
            elements.myDomainsResults.innerHTML = `
                <div class="result-box">
                    <div class="result-header">📭 No Domains Found</div>
                    <p style="color: var(--text-gray); margin-top: 10px;">
                        You don't own any domains yet. Register your first domain above!
                    </p>
                </div>
            `;
        } else {
            // Get current owner info for each domain
            const readProvider = new ethers.JsonRpcProvider('https://rpc.testnet.fluent.xyz/');
            const readContract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, readProvider);
            
            const domainDetails = await Promise.all(
                userDomains.map(async domain => {
                    try {
                        const currentOwner = await readContract.ownerOf(domain.name);
                        const currentTarget = await readContract.resolve(domain.name);
                        return {
                            ...domain,
                            currentOwner,
                            currentTarget,
                            stillOwned: currentOwner.toLowerCase() === userAddress.toLowerCase()
                        };
                    } catch (error) {
                        return {
                            ...domain,
                            currentOwner: 'Error',
                            currentTarget: 'Error',
                            stillOwned: false
                        };
                    }
                })
            );
            
            const ownedDomains = domainDetails.filter(d => d.stillOwned);
            const transferredDomains = domainDetails.filter(d => !d.stillOwned);
            
            let resultsHTML = '';
            
            if (ownedDomains.length > 0) {
                resultsHTML += `
                    <div class="result-box">
                        <div class="result-header">🏠 Your Domains (${ownedDomains.length})</div>
                        ${ownedDomains.map(domain => `
                            <div class="result-row">
                                <span class="result-label">${domain.name}:</span>
                                <span class="result-value">→ ${formatAddress(domain.currentTarget)}</span>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
            
            if (transferredDomains.length > 0) {
                resultsHTML += `
                    <div class="result-box" style="margin-top: 20px;">
                        <div class="result-header">↗️ Previously Owned (${transferredDomains.length})</div>
                        ${transferredDomains.map(domain => `
                            <div class="result-row">
                                <span class="result-label">${domain.name}:</span>
                                <span class="result-value">Now owned by ${formatAddress(domain.currentOwner)}</span>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
            
            elements.myDomainsResults.innerHTML = resultsHTML;
            elements.refreshDomainsBtn.style.display = 'inline-block';
        }
        
        showStatus('myDomainsStatus', `✅ Loaded ${userDomains.length} domains`, 'success');
        
    } catch (error) {
        console.error('Error loading user domains:', error);
        showStatus('myDomainsStatus', '❌ Error loading domains: ' + error.message, 'error');
    } finally {
        elements.loadMyDomainsBtn.innerHTML = '🔍 Load My Domains';
        elements.loadMyDomainsBtn.disabled = false;
    }
}

// Quick Search Event Listeners
elements.quickSearch.addEventListener('input', debouncedSearch);
elements.quickSearch.addEventListener('focus', debouncedSearch);
elements.quickSearch.addEventListener('blur', () => {
    setTimeout(() => elements.searchSuggestions.style.display = 'none', 200);
});

elements.quickSearchBtn.addEventListener('click', () => {
    const query = elements.quickSearch.value.toLowerCase().trim();
    if (!query) return;
    
    if (isValidDomainName(query)) {
        elements.lookupDomain.value = query;
        elements.lookupBtn.click();
    } else {
        showStatus('lookupStatus', '❌ Invalid domain name format', 'error', 3000);
    }
});

// Enter key support for quick search
elements.quickSearch.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') {
        elements.quickSearchBtn.click();
    }
});

// Event Listeners
elements.connectWallet.addEventListener('click', connectWallet);

// Stats refresh function
function showStats() {
    showStatus('registerStatus', '🔄 Refreshing statistics...', 'warning', 2000);
    loadStats();
}

// Enhanced error handling for network issues
window.addEventListener('online', () => {
    showStatus('registerStatus', '🌐 Connection restored', 'success', 2000);
    loadStats();
});

window.addEventListener('offline', () => {
    showStatus('registerStatus', '⚠️ Connection lost - some features may not work', 'warning', 5000);
});

// Auto-connect if previously connected
window.addEventListener('load', async () => {
    // Add loading animation to page elements
    document.querySelectorAll('.fade-in').forEach((el, index) => {
        el.style.animationDelay = `${index * 0.1}s`;
    });
    
    document.querySelectorAll('.scale-in').forEach((el, index) => {
        el.style.animationDelay = `${index * 0.2}s`;
    });
    
    if (typeof window.ethereum !== 'undefined') {
        const accounts = await window.ethereum.request({ method: 'eth_accounts' });
        if (accounts.length > 0) {
            await connectWallet();
        }
    }
    await loadStats();
    
    // Start periodic stats refresh
    setInterval(loadStats, 60000); // Every minute
});

// Handle account/network changes
if (typeof window.ethereum !== 'undefined') {
    window.ethereum.on('accountsChanged', (accounts) => {
        if (accounts.length === 0) {
            provider = null;
            signer = null;
            contract = null;
            userAddress = null;
            userDomains = [];
            elements.connectWallet.textContent = 'Connect Wallet';
            elements.connectWallet.disabled = false;
            elements.connectWallet.style.background = '';
            elements.registerBtn.disabled = true;
            elements.transferBtn.disabled = true;
            elements.loadMyDomainsBtn.disabled = true;
            elements.bulkRegisterBtn.disabled = true;
            elements.walletInfo.style.display = 'none';
            elements.txHistory.innerHTML = '<div style="text-align: center; color: var(--text-gray); padding: 20px;">Connect wallet to view history</div>';
            elements.refreshDomainsBtn.style.display = 'none';
            elements.myDomainsResults.innerHTML = '';
        } else {
            connectWallet();
        }
    });

    window.ethereum.on('chainChanged', () => {
        window.location.reload();
    });
}

// Keyboard shortcuts
document.addEventListener('keydown', (e) => {
    // Ctrl/Cmd + K for quick search focus
    if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
        e.preventDefault();
        elements.quickSearch.focus();
        elements.quickSearch.select();
    }
    
    // Escape to close suggestions
    if (e.key === 'Escape') {
        elements.searchSuggestions.style.display = 'none';
        document.activeElement.blur();
    }
});

// Enhanced copy function with better feedback
function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(() => {
        // Create temporary visual feedback
        const feedback = document.createElement('div');
        feedback.textContent = '✓ Copied!';
        feedback.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--success);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            z-index: 10000;
            animation: slideIn 0.3s ease;
        `;
        document.body.appendChild(feedback);
        
        setTimeout(() => {
            feedback.style.opacity = '0';
            feedback.style.transform = 'translateY(-20px)';
            setTimeout(() => document.body.removeChild(feedback), 300);
        }, 2000);
    });
}

// Performance monitoring
let performanceMetrics = {
    domainChecks: 0,
    registrations: 0,
    lookups: 0,
    errors: 0
};

// Analytics helper (privacy-friendly)
function trackEvent(event, details = {}) {
    performanceMetrics[event] = (performanceMetrics[event] || 0) + 1;
    console.log(`Event: ${event}`, details);
}

// Service worker registration for offline support (if needed in future)
if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
        // Future: Add service worker for offline functionality
        console.log('Service Worker support detected');
    });
}

// Enhanced validation with suggestions
function validateAndSuggest(domainName) {
    if (!domainName) return { valid: false, suggestion: '' };
    
    if (domainName.length < 3) {
        return { valid: false, suggestion: 'Try a longer name (minimum 3 characters)' };
    }
    
    if (domainName.length > 50) {
        return { valid: false, suggestion: 'Try a shorter name (maximum 50 characters)' };
    }
    
    if (!/^[a-z0-9-]+$/.test(domainName)) {
        const suggested = domainName.replace(/[^a-z0-9-]/g, '').toLowerCase();
        return { valid: false, suggestion: `Try: "${suggested}"` };
    }
    
    if (domainName.startsWith('-') || domainName.endsWith('-')) {
        const suggested = domainName.replace(/^-+|-+$/g, '');
        return { valid: false, suggestion: `Try: "${suggested}"` };
    }
    
    return { valid: true, suggestion: '' };
}

// Price calculator with tiers
function calculatePriceWithTier(domainName) {
    if (!domainName) return null;
    
    const length = domainName.length;
    let tier, price;
    
    if (length <= 5) {
        tier = 'Premium';
        price = '0.01';
    } else if (length <= 10) {
        tier = 'Standard'; 
        price = '0.005';
    } else {
        tier = 'Economy';
        price = '0.001';
    }
    
    return { price, tier, length };
}

// Batch availability checker
async function checkBatchAvailability(domains) {
    if (!contract) return [];
    
    const batchSize = 10; // Check in batches to avoid rate limits
    const results = [];
    
    for (let i = 0; i < domains.length; i += batchSize) {
        const batch = domains.slice(i, i + batchSize);
        const batchPromises = batch.map(async domain => {
            try {
                const available = await contract.available(domain);
                return { domain, available, error: null };
            } catch (error) {
                return { domain, available: false, error: error.message };
            }
        });
        
        const batchResults = await Promise.all(batchPromises);
        results.push(...batchResults);
        
        // Small delay between batches
        if (i + batchSize < domains.length) {
            await new Promise(resolve => setTimeout(resolve, 100));
        }
    }
    
    return results;
}

// Enhanced error messages
function getEnhancedErrorMessage(error) {
    if (error.message.includes('insufficient funds')) {
        return {
            title: '💸 Insufficient Funds',
            message: 'You need more ETH in your wallet for this transaction.',
            suggestion: 'Get testnet ETH from a faucet or try a shorter domain name for lower cost.'
        };
    }
    
    if (error.message.includes('user rejected')) {
        return {
            title: '🚫 Transaction Cancelled',
            message: 'You cancelled the transaction in your wallet.',
            suggestion: 'Click the button again when you\'re ready to proceed.'
        };
    }
    
    if (error.message.includes('network')) {
        return {
            title: '🌐 Network Error',
            message: 'Connection to Fluent Network failed.',
            suggestion: 'Check your internet connection and try again.'
        };
    }
    
    return {
        title: '❌ Error',
        message: error.message,
        suggestion: 'Please try again or contact support if the problem persists.'
    };
}

console.log('🎨 Fluent DNS Enhanced - Ready!');
console.log('Features: Bulk registration, Advanced lookup, Transaction history, Quick search');
</script>
</body>
</html>
                <div class="stat-header">
                    <span class="stat-icon">🏷️</span>
                    <div class="stat-title">Total Domains Minted</div>
                </div>
                <div class="stat-value" id="totalDomains">
                    <div class="loading loading-large"></div>
                </div>
                <div class="stat-change" id="domainsChange">Loading...</div>
            </div>

            <div class="stat-card scale-in">
                <div class="stat-header">
                    <span class="stat-icon">💰</span>
                    <div class="stat-title">Total ETH Locked</div>
                </div>
                <div class="stat-value" id="totalEthLocked">
                    <div class="loading loading-large"></div>
                </div>
                <div class="stat-change">Value locked in contract</div>
            </div>

            <div class="stat-card scale-in">
